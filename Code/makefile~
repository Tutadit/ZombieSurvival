TARGET=bin/runner
TEST_TARGET=bin/test

SRCDIR=src
TEST_SRCDIR=test

BUILDDIR=build
TEST_BUILDDIR=build\test

OBJECTS=$(BUILDDIR)\raster.o $(BUILDDIR)\clear.o $(BUILDDIR)\model.o $(BUILDDIR)\renderer.o

TEST_OBJECTS=$(OBJECTS) $(TEST_BUILDDIR)\t_raster.o $(TEST_BUILDDIR)\t_player.o $(TEST_BUILDDIR)\t_runner.o

CC=cc68x
ASM=gen

ASMFLAGS=-D -L2 -Iinclude
CFLAGS=-g
INC=-Iinclude

$(TARGET): $(OBJECTS)
	$(CC) $(CFLAGS) $(OBJECTS) -o $(TARGET)

$(BUILDDIR)\raster.o: $(SRCDIR)\raster.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<

$(BUILDDIR)\model.o: $(SRCDIR)\model.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<

$(BUILDDIR)\zombie.o: $(SRCDIR)\zombie.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<

$(BUILDDIR)\renderer.o: $(SRCDIR)\renderer.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<

$(BUILDDIR)\clear.o: $(SRCDIR)\clear.s
	$(ASM) $(ASMFLAGS) -O$@ $<

test: $(TEST_TARGET)
	@echo "Running tests..."
	bin/test

$(TEST_TARGET): $(TEST_OBJECTS)
	$(CC) $(CFLAGS) $(TEST_OBJECTS) -o $@

$(TEST_BUILDDIR)\t_raster.o: $(TEST_SRCDIR)\t_raster.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<

$(TEST_BUILDDIR)\t_player.o: $(TEST_SRCDIR)\t_player.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<


$(TEST_BUILDDIR)\t_runner.o: $(TEST_SRCDIR)\t_runner.c
	$(CC) $(CFLAGS) $(INC) -c -o $@ $<
